import{_ as G,r as f,b as S,M as H,c as s,U as J,o as v,d as K,f as a,w as o,V as w,e as C,h as O,i as p,W as Q,n as z,t as k,a0 as h,E as c,p as X,Z as Y}from"./index-1630d45c.js";const ee={class:"admins-page"},ae={class:"page-header"},te={class:"pagination-container"},le={__name:"Admins",setup(oe){const y=f(!1),x=f([]),g=f(!1),b=f(),r=S({page:1,pageSize:10,total:0}),n=S({username:"",password:"",email:"",role:"admin"}),D={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度为3-20位",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度至少6位",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},m=async()=>{y.value=!0;try{const l=await w.get("/admin/list",{params:{page:r.page,page_size:r.pageSize}});l.data.code===200&&(x.value=l.data.data.list,r.total=l.data.data.pagination.total)}catch(l){console.error("Failed to load admins:",l)}finally{y.value=!1}},U=()=>{n.username="",n.password="",n.email="",n.role="admin",g.value=!0},$=async()=>{b.value&&await b.value.validate(async l=>{if(l)try{(await w.post("/admin/create",n)).data.code===200&&(c.success("添加成功"),g.value=!1,m())}catch(e){console.error("Failed to create admin:",e)}})},B=async l=>{const e=l.status==="active"?"inactive":"active";try{(await w.put(`/admin/${l.id}/status`,{status:e})).data.code===200&&(l.status=e,c.success(`管理员 ${l.username} 已${e==="active"?"启用":"禁用"}`),m())}catch(d){console.error("Failed to update admin status:",d),c.error("更新状态失败")}},A=async l=>{X.confirm(`确定要删除管理员 ${l.username} 吗?`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{var e,d;try{(await w.delete(`/admin/${l.id}`)).data.code===200&&(c.success("删除成功"),m())}catch(i){console.error("Failed to delete admin:",i),(d=(e=i.response)==null?void 0:e.data)!=null&&d.msg?c.error(i.response.data.msg):c.error("删除失败")}}).catch(()=>{})},N=l=>{r.pageSize=l,r.page=1,m()},E=l=>{r.page=l,m()},F=l=>new Date(l).toLocaleString("zh-CN");return H(()=>{m()}),(l,e)=>{const d=s("el-icon"),i=s("el-button"),u=s("el-table-column"),M=s("el-tag"),q=s("el-table"),T=s("el-pagination"),I=s("el-card"),V=s("el-input"),_=s("el-form-item"),R=s("el-option"),L=s("el-select"),P=s("el-form"),W=s("el-dialog"),Z=J("loading");return v(),K("div",ee,[a(I,null,{default:o(()=>[C("div",ae,[e[9]||(e[9]=C("h2",null,"管理员管理",-1)),a(i,{type:"primary",onClick:U},{default:o(()=>[a(d,null,{default:o(()=>[a(O(Y))]),_:1}),e[8]||(e[8]=p(" 添加管理员 ",-1))]),_:1})]),Q((v(),z(q,{data:x.value,style:{width:"100%"}},{default:o(()=>[a(u,{prop:"id",label:"ID",width:"80"}),a(u,{prop:"username",label:"用户名",width:"150"}),a(u,{prop:"email",label:"邮箱",width:"200"}),a(u,{prop:"role",label:"角色",width:"100"}),a(u,{prop:"status",label:"状态",width:"100"},{default:o(t=>[a(M,{type:t.row.status==="active"?"success":"danger"},{default:o(()=>[p(k(t.row.status==="active"?"活跃":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(u,{prop:"created_at",label:"创建时间",width:"180"},{default:o(t=>[p(k(F(t.row.created_at)),1)]),_:1}),a(u,{label:"操作",width:"200"},{default:o(t=>[t.row.username!=="admin"?(v(),z(i,{key:0,type:"warning",size:"small",onClick:j=>B(t.row)},{default:o(()=>[p(k(t.row.status==="active"?"禁用":"启用"),1)]),_:2},1032,["onClick"])):h("",!0),t.row.username!=="admin"?(v(),z(i,{key:1,type:"danger",size:"small",onClick:j=>A(t.row)},{default:o(()=>[...e[10]||(e[10]=[p(" 删除 ",-1)])]),_:2},1032,["onClick"])):h("",!0)]),_:1})]),_:1},8,["data"])),[[Z,y.value]]),C("div",te,[a(T,{"current-page":r.page,"onUpdate:currentPage":e[0]||(e[0]=t=>r.page=t),"page-size":r.pageSize,"onUpdate:pageSize":e[1]||(e[1]=t=>r.pageSize=t),"page-sizes":[10,20,50],total:r.total,layout:"total, sizes, prev, pager, next",onSizeChange:N,onCurrentChange:E},null,8,["current-page","page-size","total"])])]),_:1}),a(W,{modelValue:g.value,"onUpdate:modelValue":e[7]||(e[7]=t=>g.value=t),title:"添加管理员",width:"500px"},{footer:o(()=>[a(i,{onClick:e[6]||(e[6]=t=>g.value=!1)},{default:o(()=>[...e[11]||(e[11]=[p("取消",-1)])]),_:1}),a(i,{type:"primary",onClick:$},{default:o(()=>[...e[12]||(e[12]=[p("确定",-1)])]),_:1})]),default:o(()=>[a(P,{ref_key:"formRef",ref:b,model:n,rules:D,"label-width":"80px"},{default:o(()=>[a(_,{label:"用户名",prop:"username"},{default:o(()=>[a(V,{modelValue:n.username,"onUpdate:modelValue":e[2]||(e[2]=t=>n.username=t)},null,8,["modelValue"])]),_:1}),a(_,{label:"密码",prop:"password"},{default:o(()=>[a(V,{modelValue:n.password,"onUpdate:modelValue":e[3]||(e[3]=t=>n.password=t),type:"password"},null,8,["modelValue"])]),_:1}),a(_,{label:"邮箱",prop:"email"},{default:o(()=>[a(V,{modelValue:n.email,"onUpdate:modelValue":e[4]||(e[4]=t=>n.email=t)},null,8,["modelValue"])]),_:1}),a(_,{label:"角色"},{default:o(()=>[a(L,{modelValue:n.role,"onUpdate:modelValue":e[5]||(e[5]=t=>n.role=t)},{default:o(()=>[a(R,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},se=G(le,[["__scopeId","data-v-797a37d2"]]);export{se as default};
