import{_ as oe,r as c,b as S,M as te,c as s,U as ne,o as N,d as de,f as l,w as o,V as b,e as w,h as $,i as r,W as se,n as re,t as g,E as D,p as ie,Y as ue,Z as pe,$ as me}from"./index-1630d45c.js";const ce={class:"users-page"},_e={class:"page-header"},fe={class:"header-actions"},ge={class:"pagination-container"},we={class:"dialog-footer"},Ve={class:"dialog-footer"},ve={__name:"Users",setup(be){const h=c(!1),F=c([]),y=c(""),I=c([]),p=S({page:1,pageSize:10,total:0}),V=c(!1),B=c("edit"),k=c(),t=S({id:null,nickname:"",wechat_no:"",phone:"",email:"",age:null,gender:null,coins:0,allow_force_add:!1}),T={phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},v=c(!1),U=c(),d=S({wechat_no:"",nickname:"",phone:"",email:"",coins:1e3,allow_force_add:!1}),j={wechat_no:[{required:!0,message:"请输入微信号",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},q=()=>{Object.assign(d,{wechat_no:"",nickname:"",phone:"",email:"",coins:1e3,allow_force_add:!1}),v.value=!0},L=async()=>{U.value&&await U.value.validate(async n=>{if(n)try{(await b.post("/users",d)).data.code===200&&(D.success("创建成功"),v.value=!1,_())}catch(e){console.error("Failed to create user:",e)}})},_=async()=>{h.value=!0;try{const n=await b.get("/users",{params:{page:p.page,page_size:p.pageSize,search:y.value}});n.data.code===200&&(F.value=n.data.data.list,p.total=n.data.data.pagination.total)}catch(n){console.error("Failed to load users:",n)}finally{h.value=!1}},O=()=>{p.page=1,_()},P=n=>{p.pageSize=n,p.page=1,_()},Q=n=>{p.page=n,_()},W=n=>{I.value=n},Y=n=>{B.value="edit",t.id=n.id,t.nickname=n.nickname||"",t.wechat_no=n.wechat_no,t.phone=n.phone,t.email=n.email||"",t.age=n.age||null,t.gender=n.gender||null,t.coins=n.coins,t.allow_force_add=n.allow_force_add,V.value=!0},Z=async()=>{k.value&&await k.value.validate(async n=>{if(n)try{(await b.put(`/users/${t.id}`,{nickname:t.nickname,wechat_no:t.wechat_no,phone:t.phone,email:t.email,age:t.age,gender:t.gender,coins:t.coins,allow_force_add:t.allow_force_add})).data.code===200&&(D.success("更新成功"),V.value=!1,_())}catch(e){console.error("Failed to update user:",e)}})},A=async n=>{try{await ie.confirm(`确定要删除用户 ${n.wechat_no} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await b.delete(`/users/${n.id}`)).data.code===200&&(D.success("删除成功"),_())}catch(e){e!=="cancel"&&console.error("Failed to delete user:",e)}},G=n=>new Date(n).toLocaleString("zh-CN");return te(()=>{_()}),(n,e)=>{const C=s("el-icon"),m=s("el-input"),f=s("el-button"),u=s("el-table-column"),H=s("el-tag"),J=s("el-table"),K=s("el-pagination"),X=s("el-card"),i=s("el-form-item"),x=s("el-input-number"),z=s("el-option"),ee=s("el-select"),E=s("el-switch"),M=s("el-form"),R=s("el-dialog"),le=ne("loading");return N(),de("div",ce,[l(X,null,{default:o(()=>[w("div",_e,[e[23]||(e[23]=w("h2",null,"用户管理",-1)),w("div",fe,[l(m,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=a=>y.value=a),placeholder:"搜索用户",style:{width:"200px","margin-right":"16px"},clearable:"",onInput:O},{prefix:o(()=>[l(C,null,{default:o(()=>[l($(ue))]),_:1})]),_:1},8,["modelValue"]),l(f,{type:"primary",onClick:q},{default:o(()=>[l(C,null,{default:o(()=>[l($(pe))]),_:1}),e[21]||(e[21]=r(" 创建用户 ",-1))]),_:1}),l(f,{type:"primary",onClick:_},{default:o(()=>[l(C,null,{default:o(()=>[l($(me))]),_:1}),e[22]||(e[22]=r(" 刷新 ",-1))]),_:1})])]),se((N(),re(J,{data:F.value,style:{width:"100%"},onSelectionChange:W},{default:o(()=>[l(u,{type:"selection",width:"55"}),l(u,{prop:"id",label:"ID",width:"80"}),l(u,{prop:"nickname",label:"昵称",width:"120"},{default:o(a=>[r(g(a.row.nickname||"-"),1)]),_:1}),l(u,{prop:"wechat_no",label:"微信号",width:"150"}),l(u,{prop:"phone",label:"手机号",width:"130"}),l(u,{prop:"email",label:"邮箱","min-width":"200"},{default:o(a=>[r(g(a.row.email||"-"),1)]),_:1}),l(u,{prop:"age",label:"年龄",width:"80"},{default:o(a=>[r(g(a.row.age||"-"),1)]),_:1}),l(u,{prop:"gender",label:"性别",width:"80"},{default:o(a=>[r(g(a.row.gender===1?"男":a.row.gender===2?"女":"-"),1)]),_:1}),l(u,{prop:"coins",label:"碰撞币",width:"100"}),l(u,{prop:"total_recharge",label:"充值总额",width:"120"},{default:o(a=>[r(" ¥"+g((a.row.total_recharge/100).toFixed(2)),1)]),_:1}),l(u,{prop:"allow_force_add",label:"允许强制加友",width:"140"},{default:o(a=>[l(H,{type:a.row.allow_force_add?"success":"info"},{default:o(()=>[r(g(a.row.allow_force_add?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),l(u,{prop:"created_at",label:"注册时间",width:"180"},{default:o(a=>[r(g(G(a.row.created_at)),1)]),_:1}),l(u,{label:"操作",fixed:"right",width:"200"},{default:o(a=>[l(f,{type:"primary",size:"small",onClick:ae=>Y(a.row)},{default:o(()=>[...e[24]||(e[24]=[r(" 编辑 ",-1)])]),_:2},1032,["onClick"]),l(f,{type:"danger",size:"small",onClick:ae=>A(a.row)},{default:o(()=>[...e[25]||(e[25]=[r(" 删除 ",-1)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,h.value]]),w("div",ge,[l(K,{"current-page":p.page,"onUpdate:currentPage":e[1]||(e[1]=a=>p.page=a),"page-size":p.pageSize,"onUpdate:pageSize":e[2]||(e[2]=a=>p.pageSize=a),"page-sizes":[10,20,50,100],total:p.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:P,onCurrentChange:Q},null,8,["current-page","page-size","total"])])]),_:1}),l(R,{modelValue:V.value,"onUpdate:modelValue":e[12]||(e[12]=a=>V.value=a),title:B.value==="edit"?"编辑用户":"查看用户",width:"500px"},{footer:o(()=>[w("span",we,[l(f,{onClick:e[11]||(e[11]=a=>V.value=!1)},{default:o(()=>[...e[26]||(e[26]=[r("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:Z},{default:o(()=>[...e[27]||(e[27]=[r("确定",-1)])]),_:1})])]),default:o(()=>[l(M,{ref_key:"formRef",ref:k,model:t,rules:T,"label-width":"120px"},{default:o(()=>[l(i,{label:"昵称"},{default:o(()=>[l(m,{modelValue:t.nickname,"onUpdate:modelValue":e[3]||(e[3]=a=>t.nickname=a),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),l(i,{label:"微信号"},{default:o(()=>[l(m,{modelValue:t.wechat_no,"onUpdate:modelValue":e[4]||(e[4]=a=>t.wechat_no=a),placeholder:"请输入微信号"},null,8,["modelValue"])]),_:1}),l(i,{label:"手机号",prop:"phone"},{default:o(()=>[l(m,{modelValue:t.phone,"onUpdate:modelValue":e[5]||(e[5]=a=>t.phone=a)},null,8,["modelValue"])]),_:1}),l(i,{label:"邮箱",prop:"email"},{default:o(()=>[l(m,{modelValue:t.email,"onUpdate:modelValue":e[6]||(e[6]=a=>t.email=a)},null,8,["modelValue"])]),_:1}),l(i,{label:"年龄"},{default:o(()=>[l(x,{modelValue:t.age,"onUpdate:modelValue":e[7]||(e[7]=a=>t.age=a),min:0,max:100,placeholder:"请输入年龄"},null,8,["modelValue"])]),_:1}),l(i,{label:"性别"},{default:o(()=>[l(ee,{modelValue:t.gender,"onUpdate:modelValue":e[8]||(e[8]=a=>t.gender=a),placeholder:"请选择性别"},{default:o(()=>[l(z,{label:"未知",value:""}),l(z,{label:"男",value:"1"}),l(z,{label:"女",value:"2"})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"碰撞币",prop:"coins"},{default:o(()=>[l(x,{modelValue:t.coins,"onUpdate:modelValue":e[9]||(e[9]=a=>t.coins=a),min:0},null,8,["modelValue"])]),_:1}),l(i,{label:"允许强制加友"},{default:o(()=>[l(E,{modelValue:t.allow_force_add,"onUpdate:modelValue":e[10]||(e[10]=a=>t.allow_force_add=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(R,{modelValue:v.value,"onUpdate:modelValue":e[20]||(e[20]=a=>v.value=a),title:"创建用户",width:"500px"},{footer:o(()=>[w("span",Ve,[l(f,{onClick:e[19]||(e[19]=a=>v.value=!1)},{default:o(()=>[...e[28]||(e[28]=[r("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:L},{default:o(()=>[...e[29]||(e[29]=[r("确定",-1)])]),_:1})])]),default:o(()=>[l(M,{ref_key:"createFormRef",ref:U,model:d,rules:j,"label-width":"120px"},{default:o(()=>[l(i,{label:"微信号",prop:"wechat_no"},{default:o(()=>[l(m,{modelValue:d.wechat_no,"onUpdate:modelValue":e[13]||(e[13]=a=>d.wechat_no=a),placeholder:"请输入微信号"},null,8,["modelValue"])]),_:1}),l(i,{label:"昵称"},{default:o(()=>[l(m,{modelValue:d.nickname,"onUpdate:modelValue":e[14]||(e[14]=a=>d.nickname=a),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),l(i,{label:"手机号",prop:"phone"},{default:o(()=>[l(m,{modelValue:d.phone,"onUpdate:modelValue":e[15]||(e[15]=a=>d.phone=a),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(i,{label:"邮箱",prop:"email"},{default:o(()=>[l(m,{modelValue:d.email,"onUpdate:modelValue":e[16]||(e[16]=a=>d.email=a),placeholder:"请输入邮箱地址"},null,8,["modelValue"])]),_:1}),l(i,{label:"碰撞币",prop:"coins"},{default:o(()=>[l(x,{modelValue:d.coins,"onUpdate:modelValue":e[17]||(e[17]=a=>d.coins=a),min:0,step:100},null,8,["modelValue"])]),_:1}),l(i,{label:"允许强制加友"},{default:o(()=>[l(E,{modelValue:d.allow_force_add,"onUpdate:modelValue":e[18]||(e[18]=a=>d.allow_force_add=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ye=oe(ve,[["__scopeId","data-v-7d1326e3"]]);export{ye as default};
