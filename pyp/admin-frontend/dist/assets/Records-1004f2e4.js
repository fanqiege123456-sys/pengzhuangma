import{_ as W,r as v,M as A,c as o,U as G,o as y,d as F,f as t,w as s,V as H,E as J,e as d,a1 as K,a3 as X,h as R,i as g,W as Z,n as Y,t as p,Y as ee,$ as ae}from"./index-1630d45c.js";const te={class:"records-page"},le={class:"filter-section"},se={class:"quick-date-btns"},ne={class:"custom-filter"},oe={class:"email-text"},de={class:"email-text"},re={class:"pagination-wrapper"},ue={__name:"Records",setup(ie){const f=v([]),k=v(!1),r=v(null),w=v(""),i=v(1),C=v(20),z=v(0),b=v("3days"),B=[{label:"今天",value:"today"},{label:"最近3天",value:"3days"},{label:"最近7天",value:"7days"},{label:"最近30天",value:"30days"},{label:"本月",value:"month"}],S=n=>{const a=n.getFullYear(),l=String(n.getMonth()+1).padStart(2,"0"),u=String(n.getDate()).padStart(2,"0");return`${a}-${l}-${u}`},x=n=>{const a=new Date,l=new Date;switch(n){case"today":break;case"3days":l.setDate(l.getDate()-2);break;case"7days":l.setDate(l.getDate()-6);break;case"30days":l.setDate(l.getDate()-29);break;case"month":l.setDate(1);break;default:l.setDate(l.getDate()-2)}return[S(l),S(a)]},U=n=>{b.value=n;const a=x(n);r.value=a,i.value=1,c()},$=()=>{b.value="",i.value=1,c()},E=n=>n.getTime()>Date.now(),c=async()=>{var n,a;try{k.value=!0;const l={page:i.value,page_size:C.value};r.value&&r.value.length===2&&(l.start_date=r.value[0],l.end_date=r.value[1]),w.value&&(l.status=w.value);const u=await H.get("/records",{params:l});u.data.code===200?(f.value=((n=u.data.data)==null?void 0:n.list)||u.data.data||[],z.value=((a=u.data.data)==null?void 0:a.total)||f.value.length):(f.value=u.data.data||[],z.value=f.value.length)}catch(l){console.error("Failed to load records:",l),J.error("加载碰撞记录失败")}finally{k.value=!1}},N=()=>{i.value=1,c()},P=()=>{i.value=1,c()},Q=()=>{c()},q=()=>{b.value="3days",r.value=x("3days"),w.value="",i.value=1,c()};return A(()=>{r.value=x("3days"),c()}),(n,a)=>{const l=o("el-button"),u=o("el-date-picker"),D=o("el-option"),I=o("el-select"),M=o("el-icon"),_=o("el-table-column"),V=o("el-tag"),T=o("el-table"),j=o("el-pagination"),L=o("el-card"),O=G("loading");return y(),F("div",te,[t(L,null,{default:s(()=>[a[7]||(a[7]=d("div",{class:"page-header"},[d("h2",null,"碰撞记录")],-1)),d("div",le,[d("div",se,[(y(),F(K,null,X(B,e=>t(l,{key:e.value,type:b.value===e.value?"primary":"default",onClick:m=>U(e.value),size:"default"},{default:s(()=>[g(p(e.label),1)]),_:2},1032,["type","onClick"])),64))]),d("div",ne,[t(u,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY年MM月DD日","value-format":"YYYY-MM-DD",onChange:$,clearable:"","disabled-date":E},null,8,["modelValue"]),t(I,{modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=e=>w.value=e),placeholder:"状态筛选",clearable:"",onChange:N,style:{width:"140px"}},{default:s(()=>[t(D,{label:"全部状态",value:""}),t(D,{label:"已匹配",value:"matched"}),t(D,{label:"已加好友",value:"friend_added"}),t(D,{label:"已错过",value:"missed"})]),_:1},8,["modelValue"]),t(l,{type:"primary",onClick:c},{default:s(()=>[t(M,null,{default:s(()=>[t(R(ee))]),_:1}),a[4]||(a[4]=g(" 查询 ",-1))]),_:1}),t(l,{onClick:q},{default:s(()=>[t(M,null,{default:s(()=>[t(R(ae))]),_:1}),a[5]||(a[5]=g(" 重置 ",-1))]),_:1})])]),Z((y(),Y(T,{data:f.value,style:{width:"100%"}},{default:s(()=>[t(_,{prop:"id",label:"ID",width:"80"}),t(_,{prop:"code",label:"碰撞码",width:"150"}),t(_,{label:"用户1","min-width":"180"},{default:s(e=>{var m,h;return[d("div",null,p(((m=e.row.user1)==null?void 0:m.wechat_no)||((h=e.row.user1)==null?void 0:h.nickname)||"-"),1),d("div",oe,p(e.row.user1_email||"-"),1)]}),_:1}),t(_,{label:"用户2","min-width":"180"},{default:s(e=>{var m,h;return[d("div",null,p(((m=e.row.user2)==null?void 0:m.wechat_no)||((h=e.row.user2)==null?void 0:h.nickname)||"-"),1),d("div",de,p(e.row.user2_email||"-"),1)]}),_:1}),t(_,{prop:"status",label:"状态",width:"100"},{default:s(e=>[t(V,{type:e.row.status==="matched"?"success":e.row.status==="friend_added"?"primary":"warning",size:"small"},{default:s(()=>[g(p(e.row.status==="matched"?"已匹配":e.row.status==="friend_added"?"已加好友":"已错过"),1)]),_:2},1032,["type"])]),_:1}),t(_,{label:"邮件状态",width:"100"},{default:s(e=>[e.row.email_sent?(y(),Y(V,{key:0,type:e.row.email_status==="sent"?"success":e.row.email_status==="failed"?"danger":"warning",size:"small"},{default:s(()=>[g(p(e.row.email_status==="sent"?"已发送":e.row.email_status==="failed"?"发送失败":"待处理"),1)]),_:2},1032,["type"])):(y(),Y(V,{key:1,type:"info",size:"small"},{default:s(()=>[...a[6]||(a[6]=[g("未发送",-1)])]),_:1}))]),_:1}),t(_,{prop:"email_sent_at",label:"邮件发送时间",width:"170"},{default:s(e=>[g(p(e.row.email_sent_at||"-"),1)]),_:1}),t(_,{prop:"created_at",label:"创建时间",width:"170"})]),_:1},8,["data"])),[[O,k.value]]),d("div",re,[t(j,{"current-page":i.value,"onUpdate:currentPage":a[2]||(a[2]=e=>i.value=e),"page-size":C.value,"onUpdate:pageSize":a[3]||(a[3]=e=>C.value=e),"page-sizes":[10,20,50,100],total:z.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:P,onCurrentChange:Q},null,8,["current-page","page-size","total"])])]),_:1})])}}},_e=W(ue,[["__scopeId","data-v-ac7f51ac"]]);export{_e as default};
