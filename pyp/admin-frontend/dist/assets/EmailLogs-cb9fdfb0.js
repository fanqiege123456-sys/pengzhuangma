import{_ as P,r as s,M as j,R as K,c as n,U as R,o as Y,d as T,f as e,w as o,V as W,E as $,e as p,g as q,h as D,i as g,W as A,n as G,t as f,Y as H,$ as J}from"./index-1630d45c.js";const O={class:"email-logs-page"},Q={class:"filter-section"},X={class:"filter-row"},Z={class:"error-text"},ee={class:"pagination-wrapper"},ae={__name:"EmailLogs",setup(le){const V=s([]),w=s(!1),c=s(""),_=s(""),r=s(null),u=s(1),h=s(20),x=s(0);let y=null;const d=async()=>{var b,l,m;try{w.value=!0;const t={page:u.value,page_size:h.value};c.value&&(t.keyword=c.value),_.value&&(t.status=_.value),r.value&&r.value.length===2&&(t.start_date=r.value[0],t.end_date=r.value[1]);const v=await W.get("/admin/api/email/logs",{params:t});v.data.code===200&&(V.value=((b=v.data.data)==null?void 0:b.list)||[],x.value=((m=(l=v.data.data)==null?void 0:l.pagination)==null?void 0:m.total)||0)}catch(t){console.error("Failed to load email logs:",t),$.error("加载邮件日志失败")}finally{w.value=!1}},z=()=>{u.value=1,d()},M=()=>{u.value=1,d()},U=()=>{d()},E=()=>{c.value="",_.value="",r.value=null,u.value=1,d()};return j(()=>{d(),y=setInterval(d,6e4)}),K(()=>{y&&clearInterval(y)}),(b,l)=>{const m=n("el-input"),t=n("el-option"),v=n("el-select"),S=n("el-date-picker"),k=n("el-icon"),C=n("el-button"),i=n("el-table-column"),B=n("el-tag"),I=n("el-table"),L=n("el-pagination"),F=n("el-card"),N=R("loading");return Y(),T("div",O,[e(F,null,{default:o(()=>[l[7]||(l[7]=p("div",{class:"page-header"},[p("h2",null,"邮件日志")],-1)),p("div",Q,[p("div",X,[e(m,{modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=a=>c.value=a),placeholder:"搜索主题或收件人",clearable:"",style:{width:"220px"},onKeyup:q(z,["enter"])},null,8,["modelValue"]),e(v,{modelValue:_.value,"onUpdate:modelValue":l[1]||(l[1]=a=>_.value=a),placeholder:"状态筛选",clearable:"",style:{width:"120px"}},{default:o(()=>[e(t,{label:"全部",value:""}),e(t,{label:"已发送",value:"sent"}),e(t,{label:"待发送",value:"pending"}),e(t,{label:"发送失败",value:"failed"})]),_:1},8,["modelValue"]),e(S,{modelValue:r.value,"onUpdate:modelValue":l[2]||(l[2]=a=>r.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"]),e(C,{type:"primary",onClick:z},{default:o(()=>[e(k,null,{default:o(()=>[e(D(H))]),_:1}),l[5]||(l[5]=g(" 查询 ",-1))]),_:1}),e(C,{onClick:E},{default:o(()=>[e(k,null,{default:o(()=>[e(D(J))]),_:1}),l[6]||(l[6]=g(" 重置 ",-1))]),_:1})])]),A((Y(),G(I,{data:V.value,style:{width:"100%"}},{default:o(()=>[e(i,{prop:"id",label:"ID",width:"70"}),e(i,{prop:"to_email",label:"收件人","min-width":"180"}),e(i,{prop:"subject",label:"主题","min-width":"250","show-overflow-tooltip":""}),e(i,{prop:"status",label:"状态",width:"100"},{default:o(a=>[e(B,{type:a.row.status==="sent"?"success":a.row.status==="failed"?"danger":"warning",size:"small"},{default:o(()=>[g(f(a.row.status==="sent"?"已发送":a.row.status==="failed"?"发送失败":"待发送"),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"type",label:"类型",width:"100"},{default:o(a=>[g(f(a.row.type==="collision"?"碰撞通知":a.row.type||"-"),1)]),_:1}),e(i,{prop:"sent_at",label:"发送时间",width:"170"},{default:o(a=>[g(f(a.row.sent_at||"-"),1)]),_:1}),e(i,{prop:"error_msg",label:"错误信息","min-width":"150","show-overflow-tooltip":""},{default:o(a=>[p("span",Z,f(a.row.error_msg||"-"),1)]),_:1})]),_:1},8,["data"])),[[N,w.value]]),p("div",ee,[e(L,{"current-page":u.value,"onUpdate:currentPage":l[3]||(l[3]=a=>u.value=a),"page-size":h.value,"onUpdate:pageSize":l[4]||(l[4]=a=>h.value=a),"page-sizes":[10,20,50,100],total:x.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:M,onCurrentChange:U},null,8,["current-page","page-size","total"])])]),_:1})])}}},oe=P(ae,[["__scopeId","data-v-350c50ce"]]);export{oe as default};
