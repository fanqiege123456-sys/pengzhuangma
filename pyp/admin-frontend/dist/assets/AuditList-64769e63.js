import{_ as ue,u as ce,r as p,b as P,M as pe,c as v,U as ge,o as L,d as q,f as t,w as a,V as z,E as d,e as s,h as w,i,g as fe,t as u,a0 as ve,W as _e,n as me,p as T,A as ye,$ as we,Y as be,v as O,a2 as W}from"./index-1630d45c.js";const he={class:"audit-list-page"},Ce={class:"page-header"},ke={class:"header-actions"},je={class:"filter-section"},Ve={key:0,class:"batch-actions"},xe={class:"selected-info"},ze={class:"stats-bar"},Re={class:"stat-item"},Se={class:"stat-value pending"},$e={class:"stat-item"},De={class:"stat-value approved"},Ae={class:"stat-item"},Le={class:"stat-value rejected"},Ue={class:"keyword-text"},Be={class:"user-info"},Ne={class:"user-id"},Ee={class:"action-btns"},Me={class:"pagination-container"},Ie={class:"reject-info"},Ke={class:"refund-notice"},Pe={class:"reject-info"},qe={__name:"AuditList",setup(Te){const Y=ce(),R=p(!1),S=p([]),g=p([]),h=p(""),b=P({pending:0,todayApproved:0,todayRejected:0}),c=P({page:1,pageSize:20,total:0}),C=p(!1),k=p(""),$=p(!1),_=p(null),j=p(!1),V=p(""),D=p(!1),F=n=>{if(!n)return"-";try{return new Date(n).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return n}},f=async()=>{var n;R.value=!0;try{const e={page:c.page,page_size:c.pageSize};h.value&&(e.keyword=h.value);const r=await z.get("/collisions/pending",{params:e});if(r.data.code===200){const l=r.data.data;S.value=(l==null?void 0:l.list)||(l==null?void 0:l.records)||l||[],c.total=((n=l==null?void 0:l.pagination)==null?void 0:n.total)||(l==null?void 0:l.total)||S.value.length,b.pending=(l==null?void 0:l.pending_count)||c.total,b.todayApproved=(l==null?void 0:l.today_approved)||0,b.todayRejected=(l==null?void 0:l.today_rejected)||0}}catch(e){console.error("åŠ è½½å¾…å®¡æ ¸åˆ—è¡¨å¤±è´¥:",e),d.error("åŠ è½½å¤±è´¥")}finally{R.value=!1}},U=()=>{c.page=1,f()},G=()=>{h.value="",c.page=1,f()},H=n=>{g.value=n},J=()=>{c.page=1,f()},Q=()=>{f()},X=async n=>{try{await T.confirm(`ç¡®å®šé€šè¿‡ã€Œ${n.tag}ã€ï¼Ÿ`,"ç¡®è®¤",{type:"success"});const e=await z.put(`/collisions/${n.id}/approve`);e.data.code===200?(d.success("å®¡æ ¸é€šè¿‡"),f()):d.error(e.data.message||"æ“ä½œå¤±è´¥")}catch(e){e!=="cancel"&&d.error("æ“ä½œå¤±è´¥")}},Z=async()=>{if(g.value.length!==0)try{await T.confirm(`ç¡®å®šæ‰¹é‡é€šè¿‡ ${g.value.length} æ¡ï¼Ÿ`,"ç¡®è®¤",{type:"success"});const n=g.value.map(r=>r.id),e=await z.put("/collisions/batch-approve",{ids:n});e.data.code===200?(d.success(`æˆåŠŸé€šè¿‡ ${n.length} æ¡`),g.value=[],f()):d.error(e.data.message||"æ“ä½œå¤±è´¥")}catch(n){n!=="cancel"&&d.error("æ“ä½œå¤±è´¥")}},ee=n=>{_.value=n,k.value="",C.value=!0},te=async()=>{if(!k.value.trim()){d.warning("è¯·è¾“å…¥æ‹’ç»åŸå› ");return}$.value=!0;try{const n=await z.put(`/collisions/${_.value.id}/reject`,{reject_reason:k.value});if(n.data.code===200){const r=(n.data.data||{}).refund_coins||_.value.cost_coins||10;d.success(`å·²æ‹’ç»ï¼Œå·²è¿”è¿˜ç”¨æˆ· ${r} ç¢°æ’å¸`),C.value=!1,f()}else d.error(n.data.message||"æ“ä½œå¤±è´¥")}catch{d.error("æ“ä½œå¤±è´¥")}finally{$.value=!1}},le=()=>{V.value="",j.value=!0},ae=async()=>{if(!V.value.trim()){d.warning("è¯·è¾“å…¥æ‹’ç»åŸå› ");return}D.value=!0;try{const n=g.value.map(r=>r.id),e=await z.put("/collisions/batch-reject",{ids:n,reject_reason:V.value});e.data.code===200?(d.success(`æˆåŠŸæ‹’ç» ${n.length} æ¡ï¼Œå·²è¿”è¿˜ç”¨æˆ·ç¢°æ’å¸`),j.value=!1,g.value=[],f()):d.error(e.data.message||"æ“ä½œå¤±è´¥")}catch{d.error("æ“ä½œå¤±è´¥")}finally{D.value=!1}},se=()=>{Y.push("/audit-settings")};return pe(()=>{f()}),(n,e)=>{const r=v("el-icon"),l=v("el-button"),A=v("el-input"),m=v("el-table-column"),oe=v("el-table"),ne=v("el-pagination"),ie=v("el-card"),B=v("el-form-item"),N=v("el-form"),E=v("el-dialog"),re=ge("loading");return L(),q("div",he,[t(ie,null,{default:a(()=>[s("div",Ce,[e[11]||(e[11]=s("h2",null,"å¾…å®¡æ ¸åˆ—è¡¨",-1)),s("div",ke,[t(l,{onClick:se},{default:a(()=>[t(r,null,{default:a(()=>[t(w(ye))]),_:1}),e[9]||(e[9]=i(" å®¡æ ¸è®¾ç½® ",-1))]),_:1}),t(l,{type:"primary",onClick:f},{default:a(()=>[t(r,null,{default:a(()=>[t(w(we))]),_:1}),e[10]||(e[10]=i(" åˆ·æ–° ",-1))]),_:1})])]),s("div",je,[t(A,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=o=>h.value=o),placeholder:"æœç´¢å…³é”®è¯",clearable:"",style:{width:"200px"},onKeyup:fe(U,["enter"])},{prefix:a(()=>[t(r,null,{default:a(()=>[t(w(be))]),_:1})]),_:1},8,["modelValue"]),t(l,{type:"primary",onClick:U},{default:a(()=>[...e[12]||(e[12]=[i("æœç´¢",-1)])]),_:1}),t(l,{onClick:G},{default:a(()=>[...e[13]||(e[13]=[i("é‡ç½®",-1)])]),_:1}),g.value.length>0?(L(),q("div",Ve,[s("span",xe,"å·²é€‰ "+u(g.value.length)+" é¡¹",1),t(l,{type:"success",size:"small",onClick:Z},{default:a(()=>[t(r,null,{default:a(()=>[t(w(O))]),_:1}),e[14]||(e[14]=i(" æ‰¹é‡é€šè¿‡ ",-1))]),_:1}),t(l,{type:"danger",size:"small",onClick:le},{default:a(()=>[t(r,null,{default:a(()=>[t(w(W))]),_:1}),e[15]||(e[15]=i(" æ‰¹é‡æ‹’ç» ",-1))]),_:1})])):ve("",!0)]),s("div",ze,[s("div",Re,[e[16]||(e[16]=s("span",{class:"stat-label"},"å¾…å®¡æ ¸",-1)),s("span",Se,u(b.pending),1)]),s("div",$e,[e[17]||(e[17]=s("span",{class:"stat-label"},"ä»Šæ—¥é€šè¿‡",-1)),s("span",De,u(b.todayApproved),1)]),s("div",Ae,[e[18]||(e[18]=s("span",{class:"stat-label"},"ä»Šæ—¥æ‹’ç»",-1)),s("span",Le,u(b.todayRejected),1)])]),_e((L(),me(oe,{data:S.value,style:{width:"100%"},stripe:"",border:"",onSelectionChange:H},{default:a(()=>[t(m,{type:"selection",width:"50"}),t(m,{prop:"id",label:"ID",width:"70",align:"center"}),t(m,{label:"å…³é”®è¯","min-width":"140"},{default:a(o=>[s("span",Ue,u(o.row.tag),1)]),_:1}),t(m,{label:"å‘å¸ƒè€…","min-width":"130"},{default:a(o=>{var y,x;return[s("div",Be,[s("span",null,u(((y=o.row.user)==null?void 0:y.nickname)||((x=o.row.user)==null?void 0:x.wechat_no)||"-"),1),s("span",Ne,"ID: "+u(o.row.user_id),1)])]}),_:1}),t(m,{label:"æäº¤æ—¶é—´",width:"170",sortable:"",prop:"created_at"},{default:a(o=>[i(u(F(o.row.created_at)),1)]),_:1}),t(m,{label:"æ¶ˆè€—ç§¯åˆ†",width:"90",align:"center"},{default:a(o=>[i(u(o.row.cost_coins),1)]),_:1}),t(m,{label:"æ“ä½œ",fixed:"right",width:"180",align:"center"},{default:a(o=>[s("div",Ee,[t(l,{type:"success",size:"small",onClick:y=>X(o.row)},{default:a(()=>[t(r,null,{default:a(()=>[t(w(O))]),_:1}),e[19]||(e[19]=i(" é€šè¿‡ ",-1))]),_:2},1032,["onClick"]),t(l,{type:"danger",size:"small",onClick:y=>ee(o.row)},{default:a(()=>[t(r,null,{default:a(()=>[t(w(W))]),_:1}),e[20]||(e[20]=i(" æ‹’ç» ",-1))]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[re,R.value]]),s("div",Me,[t(ne,{"current-page":c.page,"onUpdate:currentPage":e[1]||(e[1]=o=>c.page=o),"page-size":c.pageSize,"onUpdate:pageSize":e[2]||(e[2]=o=>c.pageSize=o),"page-sizes":[10,20,50,100],total:c.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:J,onCurrentChange:Q},null,8,["current-page","page-size","total"])])]),_:1}),t(E,{modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=o=>C.value=o),title:"æ‹’ç»ç¢°æ’ç ",width:"420px","close-on-click-modal":!1},{footer:a(()=>[t(l,{onClick:e[4]||(e[4]=o=>C.value=!1)},{default:a(()=>[...e[24]||(e[24]=[i("å–æ¶ˆ",-1)])]),_:1}),t(l,{type:"danger",onClick:te,loading:$.value},{default:a(()=>[...e[25]||(e[25]=[i("ç¡®è®¤æ‹’ç»",-1)])]),_:1},8,["loading"])]),default:a(()=>{var o,y,x,M,I,K;return[s("div",Ie,[s("p",null,[e[21]||(e[21]=i("å…³é”®è¯ï¼š",-1)),s("strong",null,u((o=_.value)==null?void 0:o.tag),1)]),s("p",null,"å‘å¸ƒè€…ï¼š"+u(((x=(y=_.value)==null?void 0:y.user)==null?void 0:x.nickname)||((I=(M=_.value)==null?void 0:M.user)==null?void 0:I.wechat_no)||"-"),1),s("p",Ke,[e[22]||(e[22]=i("ğŸ’° æ‹’ç»åå°†è¿”è¿˜ç”¨æˆ· ",-1)),s("strong",null,u(((K=_.value)==null?void 0:K.cost_coins)||10),1),e[23]||(e[23]=i(" ç¢°æ’å¸",-1))])]),t(N,null,{default:a(()=>[t(B,{label:"æ‹’ç»åŸå› ",required:""},{default:a(()=>[t(A,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=de=>k.value=de),type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥æ‹’ç»åŸå› ï¼Œå°†å±•ç¤ºç»™ç”¨æˆ·",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]}),_:1},8,["modelValue"]),t(E,{modelValue:j.value,"onUpdate:modelValue":e[8]||(e[8]=o=>j.value=o),title:"æ‰¹é‡æ‹’ç»",width:"420px","close-on-click-modal":!1},{footer:a(()=>[t(l,{onClick:e[7]||(e[7]=o=>j.value=!1)},{default:a(()=>[...e[29]||(e[29]=[i("å–æ¶ˆ",-1)])]),_:1}),t(l,{type:"danger",onClick:ae,loading:D.value},{default:a(()=>[...e[30]||(e[30]=[i("ç¡®è®¤æ‹’ç»",-1)])]),_:1},8,["loading"])]),default:a(()=>[s("div",Pe,[s("p",null,[e[26]||(e[26]=i("å³å°†æ‹’ç» ",-1)),s("strong",null,u(g.value.length),1),e[27]||(e[27]=i(" æ¡ç¢°æ’ç ",-1))]),e[28]||(e[28]=s("p",{class:"refund-notice"},"ğŸ’° æ‹’ç»åå°†è¿”è¿˜ç”¨æˆ·æ¶ˆè€—çš„ç¢°æ’å¸",-1))]),t(N,null,{default:a(()=>[t(B,{label:"ç»Ÿä¸€æ‹’ç»åŸå› ",required:""},{default:a(()=>[t(A,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=o=>V.value=o),type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥ç»Ÿä¸€çš„æ‹’ç»åŸå› ",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},We=ue(qe,[["__scopeId","data-v-57292e8e"]]);export{We as default};
