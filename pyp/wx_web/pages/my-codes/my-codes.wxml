<!--pages/my-codes/my-codes.wxml-->
<view class="container">
  <!-- 头部 -->
  <view class="header">
    <text class="header-title">我的碰撞码</text>
    <text class="header-subtitle">查看所有碰撞关键词的状态</text>
  </view>

  <!-- 统计信息 -->
  <view class="stats-section">
    <view class="stat-item">
      <text class="stat-value">{{totalCount}}</text>
      <text class="stat-label">总数</text>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-value matched">{{matchedCount}}</text>
      <text class="stat-label">已碰撞</text>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-value active-color">{{pendingCount}}</text>
      <text class="stat-label">进行中</text>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-value expired-color">{{expiredCount}}</text>
      <text class="stat-label">已过期</text>
    </view>
  </view>

  <!-- 筛选标签 -->
  <scroll-view class="filter-scroll" scroll-x>
    <view class="filter-tabs">
      <view class="filter-tab {{currentTab === 'all' ? 'active' : ''}}" bindtap="switchTab" data-tab="all">
        全部
      </view>
      <view class="filter-tab {{currentTab === 'active' ? 'active' : ''}}" bindtap="switchTab" data-tab="active">
        进行中
      </view>
      <view class="filter-tab {{currentTab === 'matched' ? 'active' : ''}}" bindtap="switchTab" data-tab="matched">
        已碰撞
      </view>
      <view class="filter-tab {{currentTab === 'expired' ? 'active' : ''}}" bindtap="switchTab" data-tab="expired">
        已过期
      </view>
    </view>
  </scroll-view>

  <!-- 碰撞码列表 -->
  <view class="codes-section">
    <scroll-view wx:if="{{filteredList.length > 0}}" class="codes-scroll" scroll-y>
      <view class="codes-list">
        <view wx:for="{{filteredList}}" wx:key="id" class="code-item {{item.status_class}}">
          <!-- 主要信息 -->
          <view class="code-main">
            <view class="code-left">
              <!-- 状态图标 -->
              <view class="code-icon {{item.status_class}}">
                <text wx:if="{{item.is_expired}}">✗</text>
                <text wx:elif="{{item.collision_status === '已碰撞' || item.is_matched}}">✓</text>
                <text wx:else>○</text>
              </view>
              <view class="code-info">
                <text class="code-keyword">{{item.tag}}</text>
                <text wx:if="{{!item.is_expired}}" class="code-time">{{item.time_left}}</text>
                <text wx:elif="{{item.is_expired}}" class="code-time">已过期</text>
              </view>
            </view>
            <view class="code-right">
              <!-- 状态标签 -->
              <view class="status-tag {{item.status_class}}">
                <text wx:if="{{item.collision_status === '已碰撞' || item.is_matched}}">已碰撞</text>
                <text wx:elif="{{item.is_expired}}">已过期</text>
                <text wx:else>进行中</text>
              </view>
              <text wx:if="{{item.match_count > 0}}" class="match-count">匹配{{item.match_count}}人</text>
              <text class="code-cost">消耗{{item.cost_coins}}币</text>
            </view>
          </view>
          
          <!-- 操作按钮 -->
          <view class="code-actions">
            <block wx:if="{{item.collision_status === '已碰撞' || item.is_matched}}">
              <view class="action-btn view-btn" bindtap="viewDetail" data-id="{{item.id}}">
                查看详情
              </view>
              <view class="action-btn edit-btn" bindtap="editCode" data-id="{{item.id}}">
                修改
              </view>
            </block>
            <block wx:elif="{{item.is_expired}}">
              <view class="action-btn renew-btn" bindtap="renewCode" data-id="{{item.id}}">
                续期（仍可匹配）
              </view>
              <view class="action-btn edit-btn" bindtap="editCode" data-id="{{item.id}}">
                修改
              </view>
              <view class="action-btn delete-btn" bindtap="deleteCode" data-id="{{item.id}}">
                删除
              </view>
            </block>
            <block wx:else>
              <view class="action-btn waiting-btn">
                等待碰撞
              </view>
              <view class="action-btn renew-btn" bindtap="renewCode" data-id="{{item.id}}">
                续费
              </view>
              <view class="action-btn edit-btn" bindtap="editCode" data-id="{{item.id}}">
                修改
              </view>
            </block>
          </view>
        </view>
      </view>
    </scroll-view>

    <!-- 空状态 -->
    <view wx:else class="empty-state">
      <text class="empty-icon">📝</text>
      <text class="empty-title">暂无碰撞码</text>
      <text class="empty-desc">去火花页面添加关键词开始碰撞吧~</text>
      <view class="empty-btn" bindtap="goToCollision">去添加</view>
    </view>
  </view>
</view>
