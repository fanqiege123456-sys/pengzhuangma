<!--pages/friends/friends.wxml-->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-section">
    <input class="search-input" placeholder="æœç´¢å¥½å‹" value="{{searchText}}" bindinput="onSearchInput" />
  </view>

  <!-- å¥½å‹åˆ—è¡¨ -->
  <scroll-view class="friends-scroll" scroll-y refresher-enabled="{{true}}" bindrefresherrefresh="onRefresh" refresher-triggered="{{refreshing}}">
    <view class="friends-list">
      <view class="friend-item" wx:for="{{friendsList}}" wx:key="id" bindtap="goToChat" data-user="{{item}}">
        <image class="friend-avatar" src="{{item.avatar}}" />
        <view class="friend-info">
          <view class="friend-name">{{item.nickname}}</view>
          <view class="friend-wechat">{{item.wechat_no}}</view>
          <view class="friend-region" wx:if="{{item.region}}">{{item.region}}</view>
        </view>
        <view class="friend-status">
          <text class="status-text {{item.status}}">
            {{item.status === 'active' ? 'æ­£å¸¸' : 'å·²å±è”½'}}
          </text>
        </view>
        <view class="friend-actions">
          <text class="action-btn" bindtap="showActions" data-friend="{{item}}" catchtap="true">â‹¯</text>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{friendsList.length === 0 && !loading}}">
      <text class="empty-icon">ğŸ‘¥</text>
      <text class="empty-text">è¿˜æ²¡æœ‰å¥½å‹</text>
      <text class="empty-desc">å»ç¢°æ’åŒ¹é…æ·»åŠ å¥½å‹å§~</text>
      <button class="btn-primary empty-action" bindtap="goToCollision">
        å¼€å§‹ç¢°æ’
      </button>
    </view>
  </scroll-view>
</view>

<!-- æ“ä½œèœå• -->
<view class="action-modal" wx:if="{{showActionModal}}" bindtap="hideActionModal">
  <view class="action-sheet" catchtap="stopPropagation">
    <view class="action-header">
      <image class="action-avatar" src="{{selectedFriend.avatar}}" />
      <text class="action-name">{{selectedFriend.nickname}}</text>
    </view>
    
    <view class="action-list">
      <view class="action-item" bindtap="startChat">
        <text class="action-text">å‘é€æ¶ˆæ¯</text>
      </view>
      
      <view class="action-item" bindtap="copyWechat">
        <text class="action-text">å¤åˆ¶å¾®ä¿¡å·</text>
      </view>
      
      <view class="action-item" bindtap="{{selectedFriend.status === 'active' ? 'blockFriend' : 'unblockFriend'}}">
        <text class="action-text">{{selectedFriend.status === 'active' ? 'å±è”½å¥½å‹' : 'å–æ¶ˆå±è”½'}}</text>
      </view>
      
      <view class="action-item danger" bindtap="deleteFriend">
        <text class="action-text">åˆ é™¤å¥½å‹</text>
      </view>
    </view>
    
    <view class="action-cancel" bindtap="hideActionModal">
      <text class="cancel-text">å–æ¶ˆ</text>
    </view>
  </view>
</view>
